name: Continuous Deployment

on:
  workflow_dispatch:
  push:
    branches: [main]
    paths:
      - "src/**"
      - "kube/**"

env:
  image: ghcr.io/${{ github.repository }}:${{ github.run_id }}

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: arwynfr/arwynfr/.github/workflows/rke2-deployment-generic.yaml@main
        with:
          sources: src
          resources: kube
        secrets:
          token: ${{ secrets.token }}
          server: ${{ secrets.server }}
          authority: ${{ secrets.authority }}